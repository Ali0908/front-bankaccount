<div class="dashboard-container">
  <!-- Header with Logo -->
  <div class="header">
    <div class="logo">
      <mat-icon>account_balance</mat-icon>
    </div>
  </div>

  <!-- Navigation and Account Info -->
  <div class="main-content">
    <!-- Left Sidebar -->
    <div class="left-sidebar">
      <!-- Home Button -->
      <div class="nav-item">
        <mat-icon class="operation-icon">home</mat-icon>
        <mat-icon class="operation-arrow placeholder">arrow_downward</mat-icon>
        <span class="operation-label">Home</span>
      </div>

      <!-- Operations -->
      <div class="operations">
        <button class="operation-item" (click)="openDepositModal()">
          <mat-icon class="operation-icon">payment</mat-icon>
          <mat-icon class="operation-arrow down">arrow_downward</mat-icon>
          <span class="operation-label">Dépôt d'argent</span>
        </button>
        <button class="operation-item" (click)="openWithdrawalModal()">
          <mat-icon class="operation-icon">payment</mat-icon>
          <mat-icon class="operation-arrow up">arrow_upward</mat-icon>
          <span class="operation-label">Retrait d'argent</span>
        </button>
        <button class="operation-item" (click)="viewStatement()">
          <mat-icon class="operation-icon">description</mat-icon>
          <mat-icon class="operation-arrow placeholder">arrow_downward</mat-icon>
          <span class="operation-label">Relevé de Compte</span>
        </button>
      </div>

      <!-- Overdraft Toggle -->
      <div class="overdraft-section">
        <mat-slide-toggle
          [checked]="isOverdraftEnabled()"
          (change)="onOverdraftToggleChange($event.checked)"
          class="overdraft-toggle"
        >
        </mat-slide-toggle>
        <span class="overdraft-label">{{ BANK_OPERATIONS_CONSTANTS.OVERDRAFT.LABEL }}</span>
        <span class="overdraft-info" *ngIf="isOverdraftEnabled()">{{
          BANK_OPERATIONS_CONSTANTS.OVERDRAFT.MAX_LIMIT
        }}</span>
      </div>
    </div>

    <!-- Divider -->
    <div class="vertical-divider"></div>

    <!-- Right Content -->
    <div class="right-content">
      <!-- Info Boxes Container -->
      <div class="info-boxes-container">
        <!-- Account Number Box -->
        <div class="info-box account-box">
          <span class="info-label">Numéro de compte</span>
          <span class="info-value">{{ account?.number || '—' }}</span>
        </div>

        <!-- Balance Box -->
        <div class="info-box balance-box">
          <span class="info-label">Compte Courant</span>
          <span
            class="info-value"
            [ngClass]="{ 'balance-negative': account && account.balance < 0 }"
          >
            {{
              account?.balance
                | currency: GENERAL_CONSTANTS.CURRENCY.EURO_CODE : 'symbol' : '1.2-2' : 'fr-FR'
            }}
          </span>
        </div>

        <!-- Savings Account Box -->
        <div class="info-box balance-box">
          <span class="info-label">{{ BANK_OPERATIONS_CONSTANTS.SAVINGS_ACCOUNT.LABEL }}</span>
          <span
            class="info-value"
            [ngClass]="{ 'balance-negative': (account?.savingsBalance ?? 0) < 0 }"
          >
            {{
              account?.savingsBalance
                | currency: GENERAL_CONSTANTS.CURRENCY.EURO_CODE : 'symbol' : '1.2-2' : 'fr-FR'
            }}
          </span>
        </div>
      </div>

      <!-- Relevé de Compte Section -->
      @if (showStatement()) {
        <div class="statement-section">
          <div class="statement-header">
            <h3>Relevé de Compte - Opérations des 30 derniers jours</h3>
            <button mat-icon-button (click)="showStatement.set(false)">
              <mat-icon>close</mat-icon>
            </button>
          </div>

          @if (loadingStatement()) {
            <div class="loading">Chargement...</div>
          }

          @if (statement() && !loadingStatement()) {
            <div class="account-info">
              <p><strong>Type de compte:</strong> {{ statement()!.accountType }}</p>
              <p><strong>Relevé du:</strong> {{ formatDate(statement()!.statementDate) }}</p>
            </div>

            @if (statement()!.transactions.length === 0) {
              <p class="no-transactions">Aucune opération sur cette période</p>
            } @else {
              <table mat-table [dataSource]="statement()!.transactions" class="transactions-table">
                <!-- Date Column -->
                <ng-container matColumnDef="date">
                  <th mat-header-cell *matHeaderCellDef>Date</th>
                  <td mat-cell *matCellDef="let tx">{{ formatDate(tx.date) }}</td>
                </ng-container>

                <!-- Type Column -->
                <ng-container matColumnDef="type">
                  <th mat-header-cell *matHeaderCellDef>Type</th>
                  <td mat-cell *matCellDef="let tx">{{ tx.type }}</td>
                </ng-container>

                <!-- Amount Column -->
                <ng-container matColumnDef="amount">
                  <th mat-header-cell *matHeaderCellDef>Montant</th>
                  <td
                    mat-cell
                    *matCellDef="let tx"
                    [class.positive]="tx.amount > 0"
                    [class.negative]="tx.amount < 0"
                  >
                    {{ formatAmount(tx.amount) }}
                  </td>
                </ng-container>

                <!-- Balance After Column -->
                <ng-container matColumnDef="balanceAfter">
                  <th mat-header-cell *matHeaderCellDef>Solde après opération</th>
                  <td mat-cell *matCellDef="let tx">{{ formatAmount(tx.balanceAfter) }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
              </table>
            }
          }
        </div>
      }
    </div>
  </div>
</div>
